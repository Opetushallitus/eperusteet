<!-- partials/muokkaus/taiteenala.html -->
<div id="toolbar" class="navbar-fixed-top ck-toolbar" style="display: none">
    <div id="ck-toolbar-top"></div>
    <div id="ck-toolbar-bottom"></div>
</div>
<div class="row">
    <pre ng-bind="morjens | json"></pre>
    <input slocalized type="text" ng-model="morjens">
    <div class="col-md-12 ep-sisalto-inner">
        <div>
            <revert-note object="tekstikappale" revert-cb="revertCb(response)" versions="versiot"
                         change-version="vaihdaVersio()"></revert-note>

            <div class="part-header-wrapper">
                <div class="action-buttons">
                    <div class="floater" ng-attr-title="{{lockNotification}}">
                        <button ng-disabled="isLocked"
                                ng-hide="tekstikappale.tila !== 'valmis' || editEnabled || !versiot.latest"
                                ng-click="muokkaa()" class="btn btn-default" icon-role="edit" kaanna="'muokkaa'"
                                oikeustarkastelu="[{target:'peruste',permission:'korjaus'}]"></button>
                        <button ng-disabled="isLocked"
                                ng-hide="tekstikappale.tila === 'valmis' || editEnabled || !versiot.latest"
                                ng-click="muokkaa()" class="btn btn-default" icon-role="edit" kaanna="'muokkaa'"
                                oikeustarkastelu="[{target:'peruste',permission:'muokkaus'}]"></button>
                    </div>
                    <button ng-show="!editEnabled && tekstikappale.tila === 'valmis'" ng-click="kopioiMuokattavaksi()"
                            class="floater btn btn-danger" icon-role="ep-text-clone" kaanna="kopioi-muokattavaksi"
                            oikeustarkastelu="{ target: 'peruste', permission: 'muokkaus' }"></button>

                    <button ng-if="tekstikappale.tila === 'valmis' || (editEnabled && !isNew)"
                            class="btn btn-danger floater" ng-click="poista()" icon-role="remove" kaanna="'poista'"
                            oikeustarkastelu="{target:'peruste',permission:'muokkaus'}"></button>
                    <div class="floater" ng-if="!editEnabled && isLocked">
                        <lukko tip="lockNotification"></lukko>
                    </div>
                </div>

                <projektin-murupolku></projektin-murupolku>

                <h1 ng-if="editEnabled">
                    <span ng-show="isNew" kaanna>luonti-tekstikappale</span>
                    <span ng-show="!isNew" kaanna>muokkaus-tekstikappale</span>
                </h1>
                <h1 ng-if="!editEnabled">
                    <span style="margin-right: 4px" ng-bind-html="tekstikappale.nimi | kaanna"></span>
                    <valmiskaannos style="font-size: 20px" is-editing="editEnabled"
                                   ng-model="editableTekstikappale"></valmiskaannos>
                </h1>
                <h5 ng-if="!editEnabled && tekstikappale.osaamisala">
                    <b>{{ 'osaamisalan-kuvaus' | kaanna }}</b>:
                    {{ tekstikappale.osaamisala.nimi | kaanna }} ({{ tekstikappale.osaamisala.arvo }})
                </h5>
            </div>

            <div class="tekstikappale" ng-class="{'edit-tekstikappale': editEnabled}">
                <div ng-if="!editEnabled">
                    <versiotiedot ng-hide="editEnabled"></versiotiedot>

                    <div class="tyoryhma-rivi">
                        <span class="tyoryhma" ng-repeat="tr in tyoryhmat">
                            <a ng-click="poistaTyoryhma(tr)" class="action-link" icon-role="remove"
                               oikeustarkastelu="{ target: 'peruste', permission: 'muokkaus' }"></a>
                            {{ tr }}
                        </span>
                        <button ng-hide="kaikkiTyoryhmat.length === 0"
                                ng-disabled="kaikkiTyoryhmat.length === tyoryhmat.length"
                                ng-click="lisaaTyoryhma()" icon-role="plus" class="btn btn-default"
                                oikeustarkastelu="{ target: 'peruste', permission: 'muokkaus' }"
                                kaanna="lisaa-tyoryhma"></button>
                    </div>

                    <div math-display ng-bind-html="valitseKieli(tekstikappale.teksti) | kuvalinkit | unsafe"
                         termisto-viitteet="tekstikappale.teksti"></div>
                </div>
                <div ng-if="editEnabled" ng-repeat="field in fields | orderBy:'order'" model="field.localeKey"
                    kiinni-oletuksena="{{field.defaultClosed}}" piilota-otsikko="{{field.hideHeader}}"
                                                                muokkauskentta-raamit>
                    <muokattava-kentta field-info="field" object-promise="tekstikappalePromise"></muokattava-kentta>
                </div>
                <div class="taiteenala-sisalto">
                    <pre ng-bind="editableTekstikappale.aikuistenOpetus | json"></pre>
                    <div ng-repeat="field in taiteenalaFields">
                        <div ng-if="editEnabled" class="taiteenala-kentta">
                            <div class="row tovp-header">
                                <div class="col-xs-10">
                                    <input
                                        ng-model-options="{ allowInvalid: true }"
                                        ng-model="editableTekstikappale[field.path].nimi"
                                        class="form-control"
                                        slocalized
                                        placeholder="{{ field.localeKey | kaanna }}"></input>
                                </div>
                                <div class="col-xs-2">
                                    <a class="remove-icon" href="" ng-click="removeTaiteenalasisalto(field.path)" class="pull-right">
                                        <span icon-role="remove"></span>
                                    </a>
                                </div>
                            </div>
                            <div
                                ng-model="editableTekstikappale[field.path].teksti"
                                class="tovp-body"
                                ckeditor
                                slocalized
                                layout="normal">
                            </div>
                        </div>
                        <div ng-if="!editEnabled && tekstikappale[field.path]">
                            <h4 class="otsikko" ng-bind-html="(tekstikappale[field.path].nimi | kaanna) || (field.localeKey | kaanna)"></h4>
                            <div ng-bind-html="tekstikappale[field.path].teksti | kaanna | kuvalinkit | unsafe"
                                math-display
                                termisto-viitteet="tekstikappale.teksti"></div>
                        </div>
                    </div>
                </div>
                <pre ng-bind="editableTekstikappale | json"></pre>
                <valmiskaannos ng-if="editEnabled" is-editing="editEnabled" ng-model="editableTekstikappale"></valmiskaannos>
            </div>
            <kommentit></kommentit>
        </div>

    </div>
</div>

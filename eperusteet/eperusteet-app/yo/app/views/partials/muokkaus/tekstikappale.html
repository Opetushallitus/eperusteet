<!--
Copyright (c) 2013 The Finnish Board of Education - Opetushallitus

This program is free software: Licensed under the EUPL, Version 1.1 or - as
soon as they will be approved by the European Commission - subsequent versions
of the EUPL (the "Licence");

You may not use this work except in compliance with the Licence.
You may obtain a copy of the Licence at: http://ec.europa.eu/idabc/eupl

This program is distributed in the hope that it will be useful,
but WITHOUT ANY WARRANTY; without even the implied warranty of
MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the
European Union Public Licence for more details.
-->

<div>
  <revert-note object="tekstikappale" revert-cb="revertCb(response)" versions="versiot" change-version="vaihdaVersio()"></revert-note>

  <div class="action-buttons">
    <div class="floater" ng-attr-title="{{lockNotification}}">
      <button ng-disabled="isLocked" ng-hide="editableTekstikappale.tila !== 'luonnos' || editEnabled || !versiot.latest"
              ng-click="muokkaa()" class="btn btn-default" icon-role="edit" kaanna="'muokkaa'"
              oikeustarkastelu="{ target: 'peruste', permission: 'muokkaus' }"></button>
    </div>
    <button ng-disabled="!canAddLapsi() && tekstikappale.tila !== 'valmis'" ng-hide="editEnabled || !versiot.latest"
            ng-click="addLapsi()" class="floater btn btn-default" icon-role="add" kaanna="lisaa-aliotsikko"
            oikeustarkastelu="{ target: 'peruste', permission: 'muokkaus' }"></button>
    <button ng-show="!editEnabled && tekstikappale.tila === 'valmis'" ng-click="kopioiMuokattavaksi()"
            class="floater btn btn-danger" icon-role="fire" kaanna="kopioi-muokattavaksi"
            oikeustarkastelu="{ target: 'peruste', permission: 'muokkaus' }"></button>

    <div class="floater" ng-if="!editEnabled && isLocked"><lukko tip="lockNotification"></lukko></div>
    <button ng-if="editEnabled && !isNew" class="btn btn-danger floater" ng-click="poista()" icon-role="remove" kaanna="'poista'"></button>
  </div>

  <div id="tekstikappale-crumbs" ng-if="!editEnabled">
    <ol class="breadcrumb" ng-if="crumbs">
      <li ng-repeat="crumb in crumbs">
        <a ui-sref="root.perusteprojekti.suoritustapa.perusteenosa({ perusteenOsanTyyppi: 'tekstikappale', perusteenOsaId: crumb.id})">{{crumb.name | kaanna}}</a>
      </li>
    </ol>
  </div>

  <h1 ng-if="editEnabled">
    <span ng-show="isNew" kaanna>luonti-tekstikappale</span>
    <span ng-show="!isNew" kaanna>muokkaus-tekstikappale</span>
  </h1>

  <div class="tekstikappale" ng-class="{'edit-tekstikappale': editEnabled, 'max-sm-leveys': !editEnabled}">
    <div ng-if="!editEnabled">
      <h1>{{tekstikappale.nimi | kaanna}}</h1>
      <versiotiedot ng-hide="editEnabled"></versiotiedot>
      <div class="tyoryhma-rivi">
        <span class="tyoryhma" ng-repeat="tr in tyoryhmat">
          <a ng-click="poistaTyoryhma(tr)" href="" icon-role="remove" oikeustarkastelu="{ target: 'peruste', permission: 'muokkaus' }"></a>
          {{ tr }}
        </span>
        <button ng-disabled="kaikkiTyoryhmat.length === 0 || kaikkiTyoryhmat.length === tyoryhmat.length"
                ng-click="lisaaTyoryhma()" icon-role="plus" class="btn btn-default"
                oikeustarkastelu="{ target: 'peruste', permission: 'muokkaus' }" kaanna="lisaa-tyoryhma"></button>
      </div>
      <div ng-bind-html="valitseKieli(tekstikappale.teksti) | unsafe"></div>
    </div>
    <div ng-if="editEnabled" ng-repeat="field in fields | orderBy:'order'" model="field.localeKey"
         kiinni-oletuksena="{{field.defaultClosed}}" piilota-otsikko="{{field.hideHeader}}" muokkauskentta-raamit>
      <muokattava-kentta field-info="field" object-promise="tekstikappalePromise"></muokattava-kentta>
    </div>
  </div>
  <kommentit></kommentit>
</div>

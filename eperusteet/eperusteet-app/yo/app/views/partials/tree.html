<div>
  <!-- <div ng-if="lisataanUuttaOsaa"> -->
  <!--   <muokkaus-tutkinnonosa tutkinnon-osa="uusiOsa"></muokkaus-tutkinnonosa> -->
  <!-- </div> -->
  <tabset>
    <tab heading="{{ 'tutkinnon-rakenne' | kaanna }}">
      <div class="muodostumisvivut">
        <a href="" ng-click="suljePolut()">
          <span ng-show="suljettuViimeksi" class="glyphicon glyphicon-chevron-down"></span>
          <span ng-hide="suljettuViimeksi" class="glyphicon glyphicon-chevron-up"></span>
          {{ 'avaa-ja-sulje' | kaanna }}
        </a>
      </div>
      <div class="tree-presentation">
        <div ng-if="!lisataanUuttaOsaa" class="tree col-lg-6 col-md-8 col-xs-12">
          <tree apumuuttujat="apumuuttujat" muokkaus="muokkaus" ng-if="rakenne.$resolved" rakenne="rakenne.rakenne" tutkinnon-osat="rakenne.tutkinnonOsat" uusi-tutkinnon-osa="uusiTutkinnonOsa"></tree>
        </div>
        <div ng-if="muokkaus" class="skratchpadlist col-lg-4 col-md-4 col-xs-12 pull-right">
          <div class="skratchpad-header">
            <div><a href="" ng-click="ryhmaModaali(rakenne.$suoritustapa)"><span class="glyphicon glyphicon-plus-sign"></span> {{ 'luo-uusi-ryhma' | kaanna }}</a></div>
          </div>
          <tabset justified="true">
            <tab heading="Leikelauta">
              <div ng-if="skratchpad.length === 0" class="skratchpad-help">{{ 'Raahaa puun osia tähän...' | kaanna }}</div>
              <div class="skratchpad-items">
                <ul ui-sortable="sortableOptions" class="tree-group skratchpad" ng-model="skratchpad">
                  <li class="skratchpad-item" ng-class="{ 'skratchpad-item-virhe': osa.$virhe }" ng-repeat="osa in skratchpad">
                    <div ng-if="osa._tutkinnonOsa">{{ rakenne.tutkinnonOsat[osa._tutkinnonOsa].nimi | kaanna }}</div>
                    <div ng-if="osa.osat !== undefined">
                      <span>
                        {{osa.nimi|kaanna}} ({{ osa.osat.length }} osaa)
                      </span>
                    </div>
                  </li>
                </ul>
              </div>
            </tab>
            <tab heading="Osat">
              <div class="skratchpad-items">
                <ul ui-sortable="sortableOptionsUnique" ng-model="uniikit">
                  <li class="skratchpad-item" ng-repeat="osa in uniikit"><div>{{ rakenne.tutkinnonOsat[osa._tutkinnonOsa].nimi | kaanna }}</div></li>
                </ul>
              </div>
            </tab>
          </tabset>
        </div>
      </div>
    </tab>
    <tab heading="Tutkinnon osat">
      <div ng-show="uniikit.length === 0" class="">
        <h3>{{ tutkinnon-osia-ei-ole | kaanna }}</h3>
      </div>
      <div ng-show="uniikit.length > 0" class="rajauslaatikko">
        <input ng-change="paivitaRajaus(tosarajaus)" ng-model="tosarajaus" type="input" class="form-control" placeholder="Rajaa tutkinnon osia...">
      </div>
      <div class="tutkinnonosa-laatikko" ng-repeat="(k, v) in rakenne.tutkinnonOsat | mapFilter:rajaaTutkinnonOsia">
        <div class="otsikko">
          <div ng-hide="muokkaus" class="muokkaus">
            <a href="" ui-sref="perusteprojekti.editoi.perusteenosa({ perusteenOsaId: v._tutkinnonOsa, perusteenOsanTyyppi: 'tutkinnonosa' })">{{ 'näytä' | kaanna }} <span class="glyphicon glyphicon-chevron-right"></span></a>
          </div>
          <h3>
            <a href="" ng-click="v.$avattu = !v.$avattu">
              <span ng-show="v.$avattu" class="glyphicon glyphicon-chevron-down"></span>
              <span ng-hide="v.$avattu" class="glyphicon glyphicon-chevron-up"></span>
              {{ v.nimi || 'uusi-tutkinnonosa' | kaanna }}
            </a>
          </h3>
        </div>
        <div ng-show="v.$avattu" class="sisalto">
          <div ng-hide="muokkaus">
            <div class="form-group">
              <label class="col-sm-2">{{ 'laajuus' | kaanna }}</label>
              <div class="col-sm-10">
                {{ v.laajuus || 0 }}
              </div>
            </div>
            <div class="clearfix"></div>
            <div class="form-group">
              <label class="col-sm-2">{{ 'yksikkö' | kaanna }}</label>
              <div class="col-sm-10">
                {{ v.yksikko || '-' | kaanna }}
              </div>
            </div>
          </div>
          <div ng-show="muokkaus">
            <form class="form-horizontal" role="form">
              <div class="form-group">
                <label class="control-label col-sm-2">{{ 'laajuus' | kaanna }}</label>
                <div class="col-sm-10">
                  <input class="form-control" ng-model="v.laajuus" type="number">
                </div>
              </div>
              <div class="form-group">
                <label class="control-label col-sm-2">{{ 'yksikkö' | kaanna }}</label>
                <div class="col-sm-8">
                  <div class="btn-group">
                    <button type="button" class="btn btn-default" ng-model="v.yksikko" btn-radio="'OPINTOVIIKKO'">{{ 'OPINTOVIIKKO' | kaanna }}</button>
                    <button type="button" class="btn btn-default" ng-model="v.yksikko" btn-radio="'OSAAMISPISTE'">{{ 'OSAAMISPISTE' | kaanna }}</button>
                  </div>
                </div>
                <div class="col-sm-2">
                  <button class="btn btn-danger" ng-click="poistaTutkinnonOsa(v)">Poista</button>
                </div>
              </div>
            </form>
          </div>
          <div class="clearfix"></div>
        </div>
      </div>
      <h3 ng-show="muokkaus">
        <a href="" ng-click="lisaaTutkinnonOsa(rakenne.$suoritustapa)">
          <span class="glyphicon glyphicon-plus"></span>
          {{ 'lisää' | kaanna }}
        </a>
      </h3>
      <h3 ng-show="muokkaus">
        <a href="" ng-click="tuoTutkinnonosa()">
          <span class="glyphicon glyphicon-cloud-download"></span>
          {{ 'tuo-tutkinnonosa' | kaanna }}
        </a>
      </h3>
    </tab>
  </tabset>
</div>

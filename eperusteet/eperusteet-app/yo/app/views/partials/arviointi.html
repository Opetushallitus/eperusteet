<!--
Copyright (c) 2013 The Finnish Board of Education - Opetushallitus

This program is free software: Licensed under the EUPL, Version 1.1 or - as
soon as they will be approved by the European Commission - subsequent versions
of the EUPL (the "Licence");

You may not use this work except in compliance with the Licence.
You may obtain a copy of the Licence at: http://ec.europa.eu/idabc/eupl

This program is distributed in the hope that it will be useful,
but WITHOUT ANY WARRANTY; without even the implied warranty of
MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the
European Union Public Licence for more details.
-->
<div>
  <div class="panel panel-default panel-small arviointi-kohdealueet">
    <span class="toggler" ng-show="arviointi.length"><a href="" class="action-link" kaanna ng-click="toggleAll()">avaa-sulje-kaikki</a></span>
    <div class="panel-body">
      <accordion close-others="false">
      <div id="sortableKohdealueet" ui-sortable="sortableOptions" ng-model="arviointi">
        <accordion-group class="arvioinnin-kohdealue" heading="{{kohdealue.otsikko | kaanna}}" ng-repeat="kohdealue in arviointi" is-open="kohdealue.$accordionOpen">
        <accordion-heading>
          <h3 class="panel-title" ng-hide="eiKohdealueita"><arvioinnin-tekstikentta sisalto="kohdealue" sisaltoteksti="kohdealue.otsikko" sisaltoalue="$parent.arviointi.arvioinninKohdealueet" edit-allowed="editAllowed"/></h3>
        </accordion-heading>

        <accordion close-others="false">
        <div id="sortableKohteet" ui-sortable="sortableOptions" ng-model="kohdealue.arvioinninKohteet">

          <accordion-group class="arvioinnin-kohde" ng-class="{'kohde-edit': arvioinninkohde === originalKohde}"
                           ng-repeat="arvioinninkohde in kohdealue.arvioinninKohteet" is-open="arvioinninkohde.$accordionOpen" is-disabled="editableKohde">
          <accordion-heading>
            <span ng-show="arvioinninkohde !== originalKohde">
              {{arvioinninkohde.otsikko | kaanna}}
              <a ng-show="editEnabled" href="" ng-click="kohde.poista(kohdealue.arvioinninKohteet, arvioinninkohde, $event)" class="muokkausnappi" icon-role="remove"></a>
              <a ng-show="editEnabled" href="" ng-click="kohde.muokkaa(arvioinninkohde, $event)" class="muokkausnappi" icon-role="edit"></a>
            </span>
            <span ng-show="arvioinninkohde === originalKohde">
              <input class="form-control kohdeotsikko" ng-model="editableKohde.otsikko" localized>
              <div class="muokkaus-napit pull-right">
                <button class="btn btn-default btn-xs" ng-click="kohde.peruMuokkaus()" kaanna>peru</button>
                <button class="btn btn-primary btn-xs" ng-click="kohde.poistuMuokkauksesta(kohdealue.arvioinninKohteet, $index)" kaanna>ok</button>
              </div>
            </span>
          </accordion-heading>

          <table>
            <tr ng-repeat="taso in arviointiasteikot[arvioinninkohde._arviointiAsteikko].osaamistasot" ng-class-odd="'raita'" ng-class-even="'ei-raitaa'">
              <td class="otsikko">{{taso.otsikko | kaanna}}</td>
              <td>
                <table ng-if="arvioinninkohde === originalKohde" ng-repeat="osaamistasonKriteeri in editableKohde.osaamistasonKriteerit | filter:{_osaamistaso: taso.id}">
                  <tbody ui-sortable="kriteeriSortableOptions" ng-model="osaamistasonKriteeri.kriteerit">
                  <tr ng-repeat="kriteeri in osaamistasonKriteeri.kriteerit">
                    <td class="dragger" ng-class="{'drag-enable': osaamistasonKriteeri.kriteerit.length > 1}"><span class="glyphicon glyphicon-resize-vertical"></span></td>
                    <td class="rivi">
                      <input class="form-control" ng-model="kriteeri" localized ui-keydown="{'enter':'!$last || rivi.uusi(osaamistasonKriteeri, $event)'}" placeholder="{{'arviointi-uusi-kriteeri-placeholder' | kaanna}}">
                    </td>
                    <td class="toiminnot">
                      <a href="" ng-click="rivi.poista(osaamistasonKriteeri.kriteerit, $index)" icon-role="minus" title="{{'arviointi-poista-kriteeri' | kaanna}}"></a>
                    </td>
                  </tr>
                  <tr class="row-adder"><td></td><td></td><td class="toiminnot"><a href="" ng-click="rivi.uusi(osaamistasonKriteeri, $event)" icon-role="add" title="{{'arviointi-uusi-kriteeri' | kaanna}}"></a></td></tr>
                  </tbody>
                </table>
                <table ng-if="arvioinninkohde !== originalKohde" ng-repeat="osaamistasonKriteeri in arvioinninkohde.osaamistasonKriteerit | filter:{_osaamistaso: taso.id}">
                  <tr ng-repeat="kriteeri in osaamistasonKriteeri.kriteerit">
                    <td class="rivi"><p>{{kriteeri | kaanna}}</p></td><td></td>
                  </tr>
                </table>
              </td>
            </tr>
          </table>
          </accordion-group> <!-- arvioinnin-kohde -->
        </div>
        </accordion>

        <!-- Kohteen lisäys -->
        <div class="panel panel-default muokkaus-lisays" ng-if="editAllowed && editEnabled">
          <div class="panel-body">
            <div ng-show="uudenKohteenTiedot.showInputArea">
              <input focus-me="uudenKohteenTiedot.showInputArea" class="form-control" type="text" ng-model="uudenKohteenTiedot.nimi" placeholder="{{'arviointi-uusi-kohde-placeholder' | kaanna}}"/><br/>
              <h4 kaanna>arviointi-asteikon-valinta</h4>
              <label ng-repeat="arviointiasteikko in arviointiasteikot">
                <input type="radio" ng-model="uudenKohteenTiedot.arviointiasteikko" ng-value="arviointiasteikko"
                       name="{{arviointiasteikko}}" ng-change="arviointiasteikkoChanged(arviointiasteikko)">
                <span ng-repeat="osaamistaso in arviointiasteikko.osaamistasot">{{osaamistaso.otsikko | kaanna}}{{$index + 1 !== arviointiasteikko.osaamistasot.length ? '&nbsp;/&nbsp;': ''}}</span>
              </label>
              <div class="muokkaus-napit">
                <button class="btn btn-default btn-xs" ng-click="kohde.cancel(uudenKohteenTiedot)" kaanna>peru</button>
                <button class="btn btn-primary btn-xs" ng-disabled="!(uudenKohteenTiedot.nimi && uudenKohteenTiedot.arviointiasteikko)" ng-click="kohde.uusi($parent.kohdealue, uudenKohteenTiedot);" kaanna>lisaa</button>
              </div>
            </div>
            <button type="button" class="btn btn-default btn-xs" ng-show="!uudenKohteenTiedot.showInputArea"
              ng-click="kohde.uusiWizard()" icon-role="add" kaanna="arviointi-uusi-kohde"></button>
          </div>
        </div>

      </accordion-group>
      </div> <!-- sortableKohdealueet -->
      </accordion>

      <!-- Kohdealueen lisäys -->
      <div class="panel panel-default muokkaus-lisays" ng-if="editAllowed && editEnabled">
        <div class="panel-body">
          <input class="form-control" ng-show="$parent.showNewKohdealueInput" type="text" ng-model="$parent.uudenKohdealueenNimi" on-enter="$parent.kohdealue.uusi()"
            on-esc="$parent.cancelNewKohdealue()" focus-me="$parent.showNewKohdealueInput" placeholder="{{'arviointi-uusi-kohdealue-placeholder' | kaanna}}"/>
          <div class="muokkaus-napit" ng-show="$parent.showNewKohdealueInput">
            <button class="btn btn-default btn-xs" ng-click="$parent.kohdealue.cancel()" kaanna>peru</button>
            <button class="btn btn-primary btn-xs" ng-disabled="!$parent.uudenKohdealueenNimi" ng-click="$parent.kohdealue.uusi()" kaanna>lisaa</button>
          </div>
          <button type="button" class="btn btn-default btn-xs" ng-show="!$parent.showNewKohdealueInput"
            ng-click="$parent.showNewKohdealueInput = true" icon-role="add" kaanna="arviointi-uusi-kohdealue"></button>
        </div>
      </div>

    </div>

  </div>
</div>

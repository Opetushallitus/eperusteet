mixin tavoite-painikkeet
  .muokkausnappi(ng-if="$ctrl.editing")
    button.btn.btn-default.icon-only(ng-click="$ctrl.poistaTavoite(tavoite)", icon-role="remove", title="{{'poista' | kaanna}}")

mixin tavoite-handle
  .sorter-handle.pull-left(ui-tree-handle)
    .icon(icon-role="drag")

mixin tavoite-naytto
  h4.tavoite-otsikko.action-link(kaanna="tavoite.tavoite || 'nimeton-tavoite'", ng-click="tavoite.$accordionOpen = !tavoite.$accordionOpen")

  .div(uib-collapse="!tavoite.$accordionOpen")
    h4(kaanna="'kohdealueet'")
    p(kaanna="tavoite.$valittuKohdealue.nimi || 'ei-asetettu'")

    h4(kaanna="'laaja-alainen-osaaminen'")
    div(tag-cloud="tavoite.$osaaminen", openable="true", edit-mode="$ctrl.editing", add-label="lisaa-laaja-alainen-osaaminen")

    h4(kaanna="tavoite.arvioinninOtsikko || 'arviointi'")
    +arviointi

  .div(ng-hide="tavoite.$accordionOpen")
    .tavoite-collapser.action-link(ng-click="tavoite.$accordionOpen = true") …

mixin arviointi
  table.table.table-default.table-bordered.perusopetuksen-arviointi
    thead
      tr(ng-if="!$ctrl.editing")
        th(ng-bind="tavoite.arvioinninKuvaus || 'arvioinnin-kohde' | kaanna")
        th(ng-bind="tavoite.arvioinninOsaamisenKuvaus || 'arvion-hyva-osaaminen' | kaanna")
      tr(ng-if="$ctrl.editing")
        th
          input.form-control(placeholder="{{'arvioinnin-kohde' | kaanna}}", slocalized, ng-model="tavoite.arvioinninKuvaus")
        th
          input.form-control(placeholder="{{'arvion-hyva-osaaminen' | kaanna}}", slocalized, ng-model="tavoite.arvioinninOsaamisenKuvaus")
        th
    tbody
      tr(ng-repeat="arvioinninKohde in tavoite.arvioinninkohteet")
        td
          span(ng-if="!$ctrl.editing", kaanna="arvioinninKohde.arvioinninKohde")
          input.form-control(ng-model='arvioinninKohde.arvioinninKohde', slocalized, ng-if="$ctrl.editing")
        td
          span(ng-if="!$ctrl.editing", kaanna="arvioinninKohde.hyvanOsaamisenKuvaus")
          textarea.form-control.msd-elastic(ng-model='arvioinninKohde.hyvanOsaamisenKuvaus', slocalized , ng-if="$ctrl.editing")
        td(ng-if="$ctrl.editing")
          a(icon-role="remove", ng-click="$ctrl.removeArvioinninKohde(tavoite, $index)", title="{{'poista' | kaanna}}")

  button.btn.btn-default(icon-role="add", kaanna="'arviointi-uusi-kriteeri'", ng-click="$ctrl.addArvioinninKohde(tavoite)", ng-if="$ctrl.editing")

mixin tavoite-muokkaus
  h4(kaanna="'nimi'")
  input.form-control(ng-model="tavoite.tavoite", slocalized, placeholder="{{'tavoitteen-nimi-placeholder' | kaanna}}")

  h4(kaanna="'kohdealueet'")
  .input-group
    select.form-control(ng-model="tavoite.$valittuKohdealue",
                        ng-change="$ctrl.asetaKohdealue(tavoite)",
                        ng-options="$ctrl.kaannaKohdealue(ka) for ka in $ctrl.vaihe.opetuksenKohdealueet")
    span.input-group-btn
      button.btn.btn-default(ng-click='$ctrl.poistaValittuKohdealue(tavoite)', icon-role='remove', kaanna="'poista'", type='button')

  h4(kaanna="'laaja-alainen-osaaminen'")
  div(tag-cloud="tavoite.$osaaminen", openable="true", edit-mode="$ctrl.editing", add-label="lisaa-laaja-alainen-osaaminen")

  div
    input.form-control(ng-model="tavoite.arvioinninOtsikko", slocalized, placeholder="{{'arvioinnin-otsikko' | kaanna}}")

    br

    +arviointi

mixin tavoite-sisalto
  .tavoite-sisalto
    .div(ng-if="!$ctrl.editing")
      +tavoite-naytto

    .div(ng-if="$ctrl.editing")
      +tavoite-muokkaus


mixin tavoite
  +tavoite-painikkeet

  div(ng-if="$ctrl.editing")
    +tavoite-handle

  +tavoite-sisalto

mixin tavoitteet
  span.toggler(ng-show="$ctrl.model.length")
    a.action-link(kaanna="'avaa-sulje-kaikki'", ng-click="$ctrl.toggleAll()")

  // Näyttö
  div(ng-if="!$ctrl.editing")
    .panel.panel-default.panel-small
      .panel-body
        .panel-group
          .panel.panel-default(ng-repeat="tavoite in $ctrl.model")
            .panel-body
              +tavoite

  // Muokkaus
  div(ng-if="$ctrl.editing")
    .panel.panel-default.panel-small
      .panel-body(ui-tree="$ctrl.treeOptions")
        .panel-group(ng-model="$ctrl.model", ui-tree-nodes="")
          .panel.panel-default(ng-repeat="tavoite in $ctrl.model" ui-tree-node="")
            .panel-body
              +tavoite

    button.btn.btn-default(ng-click="$ctrl.lisaaTavoite()", icon-role="add", kaanna="'lisaa-opetuksen-tavoite'")

  pre {{$ctrl.model | json}}

+tavoitteet

<div class="tutkinnonosa-wrapper">
  <h1 esitys-sivu-otsikko="tutkinnonOsaViite.nimi">
    {{ tutkinnonOsa.nimi | kaanna }} <span ng-show="tutkinnonOsaViite.laajuus">{{ tutkinnonOsaViite.laajuus }} {{ yksikko | kaanna }}</span>
  </h1>

  <div ng-if="tutkinnonOsa.koodiArvo">
    <strong kaanna="'koodi'"></strong>: {{ tutkinnonOsa.koodiArvo }}
  </div>

  <div ng-if="tutkinnonOsaViite.jarjestys">
    <strong kaanna="'tutkinnonosa-jarjestysnumero'"></strong>: {{ tutkinnonOsaViite.jarjestys }}
  </div>

  <div ng-if="tutkinnonOsa.valmaTelmaSisalto">
    <div ng-repeat="sisalto in [tutkinnonOsa.valmaTelmaSisalto]" ng-include="'eperusteet-esitys/views/valmatelma.html'"></div>
  </div>

  <div ng-if="tutkinnonOsa.tyyppi !== 'tutke2' && !tutkinnonOsa.valmaTelmaSisalto" ng-repeat="k in fieldKeys | orderBy: fieldOrder">
    <div ng-if="k === 'arviointi'">
      <div ng-show="tutkinnonOsa.arviointi.arvioinninKohdealueet">
        <h3 kaanna="'arviointi'"></h3>
        <div ng-repeat="kohdealue in tutkinnonOsa.arviointi.arvioinninKohdealueet">
            <div class="arviointi">
                <div class="arviointi-otsikko">
                    <h4>{{ kohdealue.otsikko | kaanna }}</h4>
                </div>
                <div class="arviointi-sisalto">
                    <div ng-repeat="kohde in kohdealue.arvioinninKohteet">
                        <h4>{{ kohde.otsikko | kaanna }}</h4>
                        <h5>{{ kohde.selite || '' | kaanna }}</h5>
                        <table class="table table-striped">
                            <tr ng-repeat="okriteeri in kohde.osaamistasonKriteerit | orderBy: '_osaamistaso'">
                                <td class="arviointi-okriteeri">
                                  <span>{{ arviointiasteikot[kohde._arviointiAsteikko][okriteeri._osaamistaso].otsikko | kaanna }}</span>
                                </td>
                                <td>
                                    <ul>
                                        <li ng-repeat="kriteeri in okriteeri.kriteerit">{{ kriteeri | kaanna }}</li>
                                    </ul>
                                </td>
                            </tr>
                        </table>
                    </div>
                </div>
            </div>
        </div>
      </div>
      <div ng-show="(!tutkinnonOsa.arviointi.arvioinninKohdealueet || tutkinnonOsa.arviointi.arvioinninKohdealueet.length === 0) && tutkinnonOsa.arviointi.lisatiedot">
        <h3 kaanna="'arviointi'"></h3>
        <div ng-bind-html="tutkinnonOsa.arviointi.lisatiedot | kaanna | unsafe"></div>
      </div>
    </div>
    <div ng-if="k !== 'arviointi' && tutkinnonOsa[k]">
      <h3 kaanna="k"></h3>
      <termisto-tekstikentta tekstikentta="tutkinnonOsa[k]"></termisto-tekstikentta>
    </div>
  </div>

  <div ng-if="tutkinnonOsa.tyyppi === 'tutke2'">
    <div>
      <span kaanna="'osa-alueet'"></span>
      <span ng-repeat="osaalue in tutkinnonOsa.osaAlueet | filter:osaAlueFilter">
        <span ng-if="!$first">&nbsp;&#124;&nbsp;</span>
        <a class="action-link" ng-click="goToAnchor('osaalue', osaalue.id)">{{ osaalue.nimi | kaanna }}</a>
      </span>
    </div>

    <termisto-tekstikentta tekstikentta="tutkinnonOsa.kuvaus"></termisto-tekstikentta>
    <div ng-repeat="osaalue in tutkinnonOsa.osaAlueet | filter:osaAlueFilter">
      <h3 id="osaalue{{ osaalue.id }}">{{osaalue.nimi | kaanna}}</h3>
      <div ng-repeat="osaamistavoitteet in osaalue.$groups.grouped">
        <div ng-repeat="tavoite in osaamistavoitteet | filter:osaAlueFilter" ng-include="'eperusteet-esitys/views/osaamistavoite.html'"></div>
      </div>
      <div ng-repeat="tavoite in osaalue.$groups.ungrouped" ng-include="'eperusteet-esitys/views/osaamistavoite.html'"></div>
      <div ng-repeat="osaalue in tutkinnonOsa.osaAlueet">
        <div ng-repeat="sisalto in [osaalue.valmaTelmaSisalto]" ng-include="'eperusteet-esitys/views/valmatelma.html'"></div>
      </div>
    </div>
  </div>

  <div class="to-vapaat-tekstit" ng-show="tutkinnonOsa.vapaatTekstit.length > 0">
    <h2 kaanna="vapaa-tekstisisalto"></h2>
    <div ng-repeat="vt in tutkinnonOsa.vapaatTekstit">
      <h3>
        <a href="" ng-click="vt.$$open = !vt.$$open">
          <span ng-hide="vt.$$open" icon-role="chevron-right"></span>
          <span ng-show="vt.$$open" icon-role="chevron-down"></span>
          <span ng-bind-html="vt.nimi | kaanna"></span>
        </a>
      </h3>
      <div uib-collapse="!vt.$$open" ng-bind-html="vt.teksti | kaanna"></div>
    </div>
  </div>

</div>
